#!/bin/bash
# A cron job for scraping weather periodically. You can also use it to create
# files between dates by adding arguments:
#   ch_scrape_weather [<UNIX-time start> [<UNIX-time end>]]
# If the second argument is omitted, then it does yesterday.

if [ $# -ge 1 ]; then
  t_start=$1
  if [ $# -eq 1 ]; then
    t_end=`date +%s`
  elif [ $# -eq 2 ]; then
    t_end=$2
  else
    echo "Usage: $0 [<UNIX-time start> [<UNIX-time end>]]"
    exit
  fi
else
  t_start=$((`date +%s` - 86400))
  t_end=`date +%s`
fi

for ((t = $t_start; t < $t_end; t += 86400)); do
  timestamp=`date -d @$t +%Y%m%d`
  /usr/local/bin/ch_translate_weather -c /etc/chime/weather.conf $timestamp
done
